var list_miembros,idEventoG,aService=new eventogrupoService,nMiembros=0,mgpService=new miembrogpService,gpService=new grupoService,evtService=new eventoService;idGrupo=$("#crm_idGrupo").val();var grupo={idGrupo:idGrupo};function getEventosAct(){var e={evtDistrito:$("#crm_idDistrito").val(),periodo:{idPeriodo:1}};evtService.getEventoAct(e,function(e){1<e.length||loadHeader(e)})}function loadHeader(e){var t='<li class="active">Evento n° '+(idEventoG=e[0].idEvento)+"</li>";t+='<li class="active">'+e[0].evtNombre+"</li>",t+='<li class="active">'+getActualDateLong()+"</li>",t+='<li class="active">Vence el '+getDateLong(new Date(e[0].evtFechaLimite))+"</li>",$(".conH").empty(),$(".conH").append(t),testEnabled(idEventoG)}function testEnabled(e){var t={id:{idEvento:e,idGrupo:idGrupo}};aService.getInfoEventogrupo(t,function(e){if(0<e.length)$(".contAsis").empty(),$(".contAsis").append(createMessageAlert("green accent-3","Felicidades, ya ha registrado la asistencia al este evento. Debe esperar a que esté disponible el siguiente evento para poder registrar la asistencia de su Grupo Pequeño"));else{$(".contAsis").empty(),$(".contAsis").append(createContextAsis()),list_miembros=$("#list_miembros");var t={idGrupo:$("#crm_idGrupo").val()};mgpService.listMiembrogp(t,loadMiembros),gpService.getGrupo(t,dataGroup)}})}function dataGroup(e){$(".titleGP").empty(),$(".titleGP").append("<small>Grupo Pequeño</small><br>"+e.gpoNombre);var t='<i class="mdi-action-home prefix grey-text darken-3"></i>';t+='<input id="lreunion" type="text" class="validate" value="'+e.gpoLugarReunion+'">',t+='<label for="lreunion" class="active">Lugar de Reunión</label>',$(".contLR").empty(),$(".contLR").append(t)}function loadMiembros(e){for(var t="",i=0,a=e.length;i<a;i++){var s=getLetter(e[i].persona.perNombres);t+="<tr>",t+='<td style="width:38px;"><button class="btn-floating waves-effect waves-light '+getColor()+'">'+s+"</button></td>",t+='<td class="ligth italic">'+e[i].persona.perNombres+" "+e[i].persona.perApellidos+"</td>",t+='<td><input type="hidden" value="'+e[i].persona.idPersona+'"></td>',t+='<td><p><input type="checkbox" class="checkO" onclick="changePF(this.id)" id="as'+e[i].persona.idPersona+'"><label for="as'+e[i].persona.idPersona+'"></label></p></td>',t+="</tr>"}$(list_miembros).empty(),$(list_miembros).append(t),startPieChart(),nMiembros=e.length,$(".valF").attr("value",nMiembros),$(".falV").empty(),$(".falV").append(nMiembros)}function saveAsis(){confirmMessage({title:"Registro de Asistencia",content:"¿Está seguro que desea registrar?"},addEventogrupo)}function addEventogrupo(){var e=parseInt($(".valP").val()),t=parseInt($(".valF").val()),i=$("#nvisitas").val(),a=$("#lreunion").val();""===i&&(i=0),parseInt(i);var s={evgPresentes:e,evgFaltas:t,evgVisitas:i,evgDescripcion:"",evgLugar:a,id:{idEvento:idEventoG,idGrupo:idGrupo}};aService.addEventogrupo(s,addAsisMiemgp)}function startPieChart(){$(".presente").easyPieChart({easing:"easeOutBounce",lineWidth:"3",barColor:"#00e676",size:60,animate:2e3,onStep:function(e,t,i){$(this.el).find(".percent").text(Math.round(i))}})}function changeAll(){$("#as").prop("checked")?$(".checkO").attr("checked","true"):$(".checkO").removeAttr("checked")}function changePF(e){var t=parseInt($(".valP").val()),i=parseInt($(".valF").val());$("#"+e).prop("checked")?(t+=1,i-=1):(i+=1,t-=1),$(".valF").attr("value",i),$(".falV").empty(),$(".falV").append(i),$(".valP").attr("value",t),$(".preV").empty(),$(".preV").append(t)}function createContextAsis(){return'<div class="col l7 s12"><div class="row"><h5 class="light italic left">Registro de Asistencia</h5></div><table class="highlight light italic"><tbody id="list_miembros"></tbody></table></div><div class="col l5 s12"><h5 class="light italic titleGP"></h5><table class="row"><tr style="margin: 0;padding: 0;"><td class="col s3 offset-s3 green-text accent-3" style="text-align: center"><h3 class="thin preV">0</h3><small>Presentes</small></td><input type="hidden" class="valP" value="0"><td class="col s3 grey-text darken-3" style="text-align: center"><h3 class="thin falV">0</h3><small>Faltas</small></td><input type="hidden" class="valF" value="0"></tr></table><div class="row"><div class="input-field col s10 offset-s1"><i class="mdi-social-people prefix grey-text darken-3"></i><input id="nvisitas" type="number" class="validate"><label for="nvisitas" class="">Número de visitas</label></div><div class="input-field col s10 offset-s1 contLR"></div></div><br><button class="btn waves-effect waves-light green accent-3 col l12 m12 s12" onclick="saveAsis()">Registrar</button></div>'}function createMessageAlert(e,t){var i='<div class="col l12 m12 s12">';return i+='<div class="card '+e+' white-text">',i+='<div class="card-content">',i+='<i class="mdi-social-notifications"></i>',i+=t,i+="</div>",(i+="</div>")+"</div>"}$(document).ready(function(){getEventosAct()});